<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Recipe Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            background: linear-gradient(135deg, #f7f3e9 0%, #e8dcc0 50%, #d4c4a0 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #2d2926;
            line-height: 1.6;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .header {
            text-align: center;
            padding: 60px 0;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            margin-bottom: 40px;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 500;
            color: #3a5f3a;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.1rem;
            color: #5a5248;
            max-width: 500px;
            margin: 0 auto;
            font-weight: 300;
        }

        .main-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 48px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(58, 95, 58, 0.2);
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            color: #3a5f3a;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: 0.01em;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(58, 95, 58, 0.4);
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(58, 95, 58, 0.15);
        }

        .nav-btn.active {
            background: #3a5f3a;
            color: white;
            border-color: #3a5f3a;
            box-shadow: 0 4px 20px rgba(58, 95, 58, 0.3);
        }

        .section {
            display: none;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }

        .section.active {
            display: block;
        }

        .section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2rem;
            font-weight: 500;
            color: #3a5f3a;
            margin-bottom: 32px;
            text-align: center;
            letter-spacing: -0.01em;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #3a5f3a;
            font-size: 14px;
            letter-spacing: 0.01em;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid rgba(90, 82, 72, 0.2);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: #2d2926;
            font-family: 'Inter', sans-serif;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #3a5f3a;
            box-shadow: 0 0 0 3px rgba(58, 95, 58, 0.1);
            background: white;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .btn {
            background: linear-gradient(135deg, #3a5f3a 0%, #2d4f2d 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(58, 95, 58, 0.3);
            font-family: 'Inter', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(58, 95, 58, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8b7355 0%, #6b5b47 100%);
            box-shadow: 0 4px 16px rgba(139, 115, 85, 0.3);
            margin-left: 12px;
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 24px rgba(139, 115, 85, 0.4);
        }

        .recipe-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 28px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .recipe-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3a5f3a, #8b7355, #3a5f3a);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .recipe-card:hover::before {
            opacity: 1;
        }

        .recipe-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.12);
            border-color: rgba(58, 95, 58, 0.2);
        }

        .recipe-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .recipe-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-weight: 500;
            color: #2d2926;
            margin-bottom: 8px;
            letter-spacing: -0.01em;
        }

        .recipe-meta {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: #5a5248;
            margin-bottom: 12px;
            align-items: center;
        }

        .hero-ingredient {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            color: #3a5f3a;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 1px solid rgba(58, 95, 58, 0.2);
        }

        .time-badge {
            background: linear-gradient(135deg, #8b7355 0%, #6b5b47 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.01em;
        }

        .rating {
            display: flex;
            gap: 4px;
            margin-top: 4px;
        }

        .star {
            cursor: pointer;
            font-size: 1.3em;
            color: #d4c4a0;
            transition: all 0.2s ease;
        }

        .star.filled {
            color: #f4a261;
        }

        .star:hover {
            color: #f4a261;
            transform: scale(1.1);
        }

        .star.non-interactive {
            cursor: default;
        }

        .star.non-interactive:hover {
            transform: none;
        }

        .recipe-photo {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 16px;
            margin-left: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .recipe-photo:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        }

        .delete-btn {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(108, 117, 125, 0.2);
            font-family: 'Inter', sans-serif;
        }

        .delete-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
            background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
        }

        .recipe-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            gap: 12px;
        }

        .cooking-log {
            background: rgba(248, 243, 233, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 196, 160, 0.3);
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
        }

        .log-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(212, 196, 160, 0.2);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .filter-section {
            background: rgba(248, 243, 233, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 196, 160, 0.3);
            padding: 28px;
            border-radius: 20px;
            margin-bottom: 32px;
        }

        .filter-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3rem;
            color: #3a5f3a;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .filter-row {
            display: flex;
            gap: 24px;
            align-items: end;
            flex-wrap: wrap;
        }

        .success-message {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }

            .header {
                padding: 40px 16px;
            }

            .section {
                padding: 28px 20px;
                border-radius: 16px;
            }

            .recipe-header {
                flex-direction: column;
            }
            
            .recipe-photo {
                margin-left: 0;
                margin-top: 16px;
                width: 100%;
                height: 200px;
            }
            
            .filter-row {
                flex-direction: column;
                align-items: stretch;
                gap: 16px;
            }
            
            .main-nav {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }

            .nav-btn {
                width: 200px;
                text-align: center;
            }

            .recipe-card {
                padding: 24px 20px;
            }
            
            /* Fix for Log Cooking Session buttons on mobile */
            #log-cooking .btn {
                margin-left: 0;
                margin-bottom: 16px;
                width: 100%;
            }
            
            #log-cooking .btn:last-child {
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üåø My Recipe Kitchen</h1>
            <p>A thoughtful collection of your favorite recipes, beautifully organized</p>
        </div>
    </div>

    <div class="container">
        <div class="main-nav">
            <button class="nav-btn active" data-section="my-recipes">My Recipes</button>
            <button class="nav-btn" data-section="add-recipe">Add Recipe</button>
        </div>

        <!-- My Recipes Section -->
        <div id="my-recipes" class="section active">
            <h2>My Recipe Collection</h2>
            
            <div class="filter-section">
                <h3>Filter & Search</h3>
                <div class="filter-row">
                    <div class="form-group" style="margin-bottom: 0; flex: 1;">
                        <label for="hero-filter">Main Ingredient:</label>
                        <select id="hero-filter">
                            <option value="">All Ingredients</option>
                            <option value="chicken">Chicken</option>
                            <option value="beef">Beef</option>
                            <option value="pork">Pork</option>
                            <option value="fish">Fish</option>
                            <option value="seafood">Seafood</option>
                            <option value="vegetables">Vegetables</option>
                            <option value="pasta">Pasta</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0; flex: 1;">
                        <label for="time-filter">Maximum Time:</label>
                        <select id="time-filter">
                            <option value="">Any Duration</option>
                            <option value="20">20 minutes</option>
                            <option value="30">30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">1 hour</option>
                            <option value="90">1.5 hours</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="recipes-list"></div>
        </div>

        <!-- Add Recipe Section -->
        <div id="add-recipe" class="section">
            <h2>Add New Recipe</h2>
            <div id="add-recipe-success" style="display: none;"></div>
            <form id="recipe-form" novalidate>
                <div class="form-group">
                    <label for="recipe-title">Recipe Title: *</label>
                    <input type="text" id="recipe-title" placeholder="Enter your recipe name">
                </div>

                <div class="form-group">
                    <label for="hero-ingredient">Main Ingredient: *</label>
                    <select id="hero-ingredient">
                        <option value="">Choose primary ingredient</option>
                        <option value="chicken">Chicken</option>
                        <option value="beef">Beef</option>
                        <option value="pork">Pork</option>
                        <option value="fish">Fish</option>
                        <option value="seafood">Seafood</option>
                        <option value="vegetables">Vegetables</option>
                        <option value="pasta">Pasta</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ingredients">Ingredients (one per line): *</label>
                    <textarea id="ingredients" placeholder="2 chicken breasts&#10;1 cup jasmine rice&#10;2 tbsp olive oil&#10;1 tsp salt"></textarea>
                </div>

                <div class="form-group">
                    <label for="instructions">Cooking Instructions: *</label>
                    <textarea id="instructions" placeholder="1. Season chicken with salt and pepper...&#10;2. Heat olive oil in a large pan...&#10;3. Cook chicken for 6-7 minutes per side..."></textarea>
                </div>

                <div style="display: flex; gap: 20px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="prep-time">Prep Time (minutes): *</label>
                        <input type="number" id="prep-time" min="1" placeholder="15">
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label for="cook-time">Cook Time (minutes): *</label>
                        <input type="number" id="cook-time" min="1" placeholder="25">
                    </div>
                </div>

                <button type="button" id="add-recipe-btn" class="btn">Add Recipe</button>
            </form>
        </div>

        <!-- Log Cooking Session Section -->
        <div id="log-cooking" class="section">
            <h2>Log Cooking Session</h2>
            <div id="log-cooking-content"></div>
        </div>
    </div>

    <script>
        // App data
        const appData = {
            recipes: [
                {
                    id: 1,
                    title: "Honey Garlic Chicken Thighs",
                    heroIngredient: "chicken",
                    ingredients: ["4 chicken thighs", "3 cloves garlic, minced", "1/4 cup honey", "2 tbsp soy sauce", "1 tbsp olive oil", "Salt and pepper to taste"],
                    instructions: "1. Season chicken thighs with salt and pepper\n2. Heat olive oil in a large pan over medium-high heat\n3. Cook chicken skin-side down for 6-7 minutes until golden\n4. Flip and cook for another 5-6 minutes\n5. Mix honey, garlic, and soy sauce in a small bowl\n6. Pour sauce over chicken and simmer for 2 minutes until glazed",
                    prepTime: 10,
                    cookTime: 20,
                    cookingLog: [
                        { date: "2025-07-28", rating: 5, photo: null },
                        { date: "2025-07-15", rating: 4, photo: null }
                    ],
                    photo: null
                },
                {
                    id: 2,
                    title: "Asian Beef Stir Fry",
                    heroIngredient: "beef",
                    ingredients: ["1 lb beef sirloin, sliced thin", "2 cups mixed vegetables", "2 tbsp vegetable oil", "3 tbsp stir fry sauce", "1 cup jasmine rice", "2 green onions, sliced"],
                    instructions: "1. Cook jasmine rice according to package instructions\n2. Heat oil in a wok or large pan over high heat\n3. Add beef and cook 3-4 minutes until browned\n4. Add mixed vegetables and stir-fry for 3-4 minutes\n5. Pour in stir fry sauce and toss everything together\n6. Garnish with green onions and serve over rice",
                    prepTime: 15,
                    cookTime: 15,
                    cookingLog: [
                        { date: "2025-07-25", rating: 4, photo: null }
                    ],
                    photo: null
                }
            ],
            currentRecipeForLogging: null,
            currentSessionRating: 0
        };

        // Make RecipeManager globally accessible - THIS FIXES THE MAIN ISSUE
        window.RecipeManager = {
            init() {
                console.log('üöÄ Recipe Manager initializing...');
                this.setupEventListeners();
                this.displayRecipes();
                console.log('‚úÖ Recipe Manager initialized successfully');
            },

            setupEventListeners() {
                console.log('üì° Setting up event listeners...');
                
                // Navigation
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const section = e.target.getAttribute('data-section');
                        console.log('üîÑ Switching to section:', section);
                        this.showSection(section);
                    });
                });

                // Add Recipe Button - Direct click handler instead of form submit
                const addRecipeBtn = document.getElementById('add-recipe-btn');
                if (addRecipeBtn) {
                    addRecipeBtn.addEventListener('click', (e) => {
                        console.log('üìù Add recipe button clicked');
                        this.addRecipe(e);
                    });
                    console.log('‚úÖ Add recipe button listener attached');
                } else {
                    console.error('‚ùå Add recipe button not found');
                }

                // Filters
                const heroFilter = document.getElementById('hero-filter');
                const timeFilter = document.getElementById('time-filter');
                
                if (heroFilter) {
                    heroFilter.addEventListener('change', () => {
                        console.log('üîç Filter changed - hero ingredient');
                        this.displayRecipes();
                    });
                }
                
                if (timeFilter) {
                    timeFilter.addEventListener('change', () => {
                        console.log('üîç Filter changed - time');
                        this.displayRecipes();
                    });
                }
                
                console.log('‚úÖ All event listeners set up');
            },

            showSection(sectionId) {
                console.log('üìÑ Showing section:', sectionId);
                
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Remove active from nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Show target section and activate nav button
                const targetSection = document.getElementById(sectionId);
                const targetBtn = document.querySelector(`[data-section="${sectionId}"]`);
                
                if (targetSection) {
                    targetSection.classList.add('active');
                    console.log('‚úÖ Section shown:', sectionId);
                } else {
                    console.error('‚ùå Section not found:', sectionId);
                }
                
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
            },

            displayRecipes() {
                console.log('üìã Displaying recipes...');
                
                const recipesList = document.getElementById('recipes-list');
                if (!recipesList) {
                    console.error('‚ùå Recipes list element not found');
                    return;
                }
                
                const heroFilter = document.getElementById('hero-filter')?.value || '';
                const timeFilter = parseInt(document.getElementById('time-filter')?.value) || 0;
                
                console.log('üîç Filters applied:', { heroFilter, timeFilter });
                
                let filteredRecipes = [...appData.recipes];
                
                if (heroFilter) {
                    filteredRecipes = filteredRecipes.filter(recipe => recipe.heroIngredient === heroFilter);
                }
                
                if (timeFilter) {
                    filteredRecipes = filteredRecipes.filter(recipe => 
                        (recipe.prepTime + recipe.cookTime) <= timeFilter
                    );
                }
                
                // Sort recipes by most recent cooking history
                console.log('üìä Sorting recipes by cooking history...');
                filteredRecipes.sort((a, b) => {
                    const getLastCookedDate = (recipe) => {
                        if (!recipe.cookingLog || recipe.cookingLog.length === 0) {
                            return null; // No cooking history
                        }
                        return recipe.cookingLog[0].date; // Most recent date (newest first in array)
                    };
                    
                    const dateA = getLastCookedDate(a);
                    const dateB = getLastCookedDate(b);
                    
                    // Recipes without history go to bottom
                    if (!dateA && !dateB) return 0; // Both have no history - maintain original order
                    if (!dateA) return 1;  // A has no history, goes after B
                    if (!dateB) return -1; // B has no history, A goes first
                    
                    // Both have history - sort by most recent (newest first)
                    return dateB.localeCompare(dateA);
                });
                
                console.log(`üìä Showing ${filteredRecipes.length} of ${appData.recipes.length} recipes (sorted by recent cooking)`);
                
                if (filteredRecipes.length === 0) {
                    recipesList.innerHTML = '<p style="text-align: center; color: #5a5248; padding: 40px;">No recipes match your current filters.</p>';
                    return;
                }
                
                recipesList.innerHTML = filteredRecipes.map(recipe => {
                    const totalRatings = recipe.cookingLog.length;
                    const sumRatings = recipe.cookingLog.reduce((sum, entry) => sum + entry.rating, 0);
                    const avgRating = totalRatings > 0 ? Math.round(sumRatings / totalRatings) : 0;
                    
                    return `
                    <div class="recipe-card">
                        <div class="recipe-header">
                            <div>
                                <div class="recipe-title">${recipe.title}</div>
                                <div class="recipe-meta">
                                    <span class="hero-ingredient">${recipe.heroIngredient}</span>
                                    <span class="time-badge">Prep: ${recipe.prepTime}min ‚Ä¢ Cook: ${recipe.cookTime}min</span>
                                </div>
                                <div class="rating">
                                    ${[1,2,3,4,5].map(star => 
                                        `<span class="star non-interactive ${star <= avgRating ? 'filled' : ''}">‚òÖ</span>`
                                    ).join('')}
                                    ${totalRatings > 0 ? `<span style="margin-left: 8px; font-size: 0.9em; color: #5a5248;">(${totalRatings} session${totalRatings !== 1 ? 's' : ''})</span>` : '<span style="margin-left: 8px; font-size: 0.9em; color: #5a5248;">(No sessions yet)</span>'}
                                </div>
                            </div>
                            ${recipe.photo ? `<img src="${recipe.photo}" alt="${recipe.title}" class="recipe-photo">` : ''}
                        </div>
                        
                        <div style="margin-bottom: 16px;"><strong>Ingredients:</strong></div>
                        <div style="margin-bottom: 16px; color: #5a5248;">${recipe.ingredients.join(' ‚Ä¢ ')}</div>
                        
                        <div style="margin-bottom: 8px;"><strong>Instructions:</strong></div>
                        <div style="white-space: pre-line; margin-bottom: 20px; color: #5a5248; line-height: 1.6;">${recipe.instructions}</div>
                        
                        <div class="cooking-log">
                            <strong>Cooking History:</strong>
                            ${recipe.cookingLog.length > 0 ? recipe.cookingLog.map(entry => 
                                `<div class="log-entry">
                                    <span>${entry.date}</span>
                                    <span>${'‚òÖ'.repeat(entry.rating)}</span>
                                </div>`
                            ).join('') : '<div style="color: #5a5248; font-style: italic; padding: 8px 0;">No cooking sessions logged yet</div>'}
                        </div>
                        
                        <div class="recipe-actions">
                            <button class="btn log-session-btn" id="log-btn-${recipe.id}">Log Cooking Session</button>
                            <button class="delete-btn" id="delete-btn-${recipe.id}" title="Delete Recipe">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
                }).join('');
                
                // After HTML is rendered, attach event listeners to the buttons
                console.log('üîó Attaching event listeners to recipe buttons...');
                filteredRecipes.forEach(recipe => {
                    // Attach delete button listener
                    const deleteBtn = document.getElementById(`delete-btn-${recipe.id}`);
                    if (deleteBtn) {
                        deleteBtn.addEventListener('click', () => {
                            console.log(`üóëÔ∏è Delete button clicked for recipe: ${recipe.title}`);
                            this.deleteRecipe(recipe.id);
                        });
                    }
                    
                    // Attach log session button listener
                    const logBtn = document.getElementById(`log-btn-${recipe.id}`);
                    if (logBtn) {
                        logBtn.addEventListener('click', () => {
                            console.log(`üç≥ Log session button clicked for recipe: ${recipe.title}`);
                            this.startLogSession(recipe.id);
                        });
                    }
                });
                
                console.log('‚úÖ Recipes displayed successfully with direct event listeners attached');
            },

            addRecipe(e) {
                console.log('‚ûï Adding new recipe...');
                
                try {
                    const title = document.getElementById('recipe-title')?.value?.trim();
                    const heroIngredient = document.getElementById('hero-ingredient')?.value;
                    const ingredientsText = document.getElementById('ingredients')?.value?.trim();
                    const instructions = document.getElementById('instructions')?.value?.trim();
                    const prepTime = parseInt(document.getElementById('prep-time')?.value);
                    const cookTime = parseInt(document.getElementById('cook-time')?.value);
                    
                    console.log('üìù Form data collected:', {
                        title: title || 'EMPTY',
                        heroIngredient: heroIngredient || 'EMPTY',
                        ingredientsText: ingredientsText ? 'HAS_CONTENT' : 'EMPTY',
                        instructions: instructions ? 'HAS_CONTENT' : 'EMPTY',
                        prepTime,
                        cookTime
                    });
                    
                    // Validation with detailed logging
                    if (!title) {
                        alert('Please enter a recipe title.');
                        console.log('‚ùå Validation failed: missing title');
                        document.getElementById('recipe-title').focus();
                        return;
                    }
                    
                    if (!heroIngredient) {
                        alert('Please select a main ingredient.');
                        console.log('‚ùå Validation failed: missing hero ingredient');
                        document.getElementById('hero-ingredient').focus();
                        return;
                    }
                    
                    if (!ingredientsText) {
                        alert('Please enter ingredients.');
                        console.log('‚ùå Validation failed: missing ingredients');
                        document.getElementById('ingredients').focus();
                        return;
                    }
                    
                    if (!instructions) {
                        alert('Please enter cooking instructions.');
                        console.log('‚ùå Validation failed: missing instructions');
                        document.getElementById('instructions').focus();
                        return;
                    }
                    
                    if (!prepTime || prepTime < 1) {
                        alert('Please enter a valid prep time (at least 1 minute).');
                        console.log('‚ùå Validation failed: invalid prep time');
                        document.getElementById('prep-time').focus();
                        return;
                    }
                    
                    if (!cookTime || cookTime < 1) {
                        alert('Please enter a valid cook time (at least 1 minute).');
                        console.log('‚ùå Validation failed: invalid cook time');
                        document.getElementById('cook-time').focus();
                        return;
                    }
                    
                    console.log('‚úÖ Validation passed');
                    
                    const ingredients = ingredientsText.split('\n').filter(i => i.trim()).map(i => i.trim());
                    
                    const newRecipe = {
                        id: Date.now(),
                        title,
                        heroIngredient,
                        ingredients,
                        instructions,
                        prepTime,
                        cookTime,
                        cookingLog: [],
                        photo: null
                    };
                    
                    console.log('üîÑ Adding recipe to collection...');
                    appData.recipes.unshift(newRecipe);
                    console.log(`‚úÖ Recipe added! Total recipes: ${appData.recipes.length}`);
                    
                    // Show success message
                    const successDiv = document.getElementById('add-recipe-success');
                    if (successDiv) {
                        successDiv.innerHTML = '<div class="success-message">‚úÖ Recipe added successfully! Your new recipe is now in your collection.</div>';
                        successDiv.style.display = 'block';
                        console.log('‚úÖ Success message shown');
                        
                        // Hide success message after 3 seconds
                        setTimeout(() => {
                            successDiv.style.display = 'none';
                            console.log('üîÑ Success message hidden');
                        }, 3000);
                    } else {
                        console.error('‚ùå Success div not found');
                    }
                    
                    // Reset form
                    const form = document.getElementById('recipe-form');
                    if (form) {
                        form.reset();
                        console.log('üîÑ Form reset');
                    } else {
                        console.error('‚ùå Form not found for reset');
                    }
                    
                    // Refresh display and switch to recipes view
                    this.displayRecipes();
                    console.log('üîÑ Display refreshed');
                    
                    // Switch to My Recipes section to show the new recipe
                    setTimeout(() => {
                        this.showSection('my-recipes');
                        console.log('üîÑ Switched to recipes view');
                    }, 1000);
                    
                } catch (error) {
                    console.error('‚ùå Error in addRecipe:', error);
                    alert('An error occurred while adding the recipe. Please check the console for details and try again.');
                }
            },

            startLogSession(recipeId) {
                console.log('üç≥ Starting log session for recipe ID:', recipeId);
                
                const recipe = appData.recipes.find(r => r.id === recipeId);
                if (!recipe) {
                    console.error('‚ùå Recipe not found with ID:', recipeId);
                    alert('Recipe not found!');
                    return;
                }
                
                console.log('‚úÖ Recipe found:', recipe.title);
                
                appData.currentRecipeForLogging = recipe;
                appData.currentSessionRating = 0;
                this.showSection('log-cooking');
                
                const logContent = document.getElementById('log-cooking-content');
                if (!logContent) {
                    console.error('‚ùå Log cooking content element not found');
                    return;
                }
                
                console.log('üîÑ Building log session form...');
                
                logContent.innerHTML = `
                    <div class="recipe-card" style="margin-bottom: 32px;">
                        <div class="recipe-title" style="margin-bottom: 16px;">${recipe.title}</div>
                        <div style="color: #5a5248;">You're about to log a cooking session for this recipe.</div>
                    </div>
                    
                    <div id="log-session-success" style="display: none;"></div>
                    
                    <div class="form-group">
                        <label>How would you rate this cooking session? *</label>
                        <div class="rating" style="margin-top: 8px;" id="session-rating-stars">
                            ${[1,2,3,4,5].map(rating => 
                                `<span class="star" onclick="RecipeManager.selectRating(${rating})" data-rating="${rating}">‚òÖ</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="session-photo">Photo of your dish (optional):</label>
                        <input type="file" id="session-photo" accept="image/*">
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <button class="btn" onclick="RecipeManager.saveSession()">Save Cooking Session</button>
                        <button class="btn btn-secondary" onclick="RecipeManager.cancelSession()">Cancel</button>
                    </div>
                `;
                
                console.log('‚úÖ Log session form created successfully');
            },

            selectRating(rating) {
                console.log('‚≠ê Rating selected:', rating);
                
                if (!rating || rating < 1 || rating > 5) {
                    console.error('‚ùå Invalid rating:', rating);
                    return;
                }
                
                appData.currentSessionRating = rating;
                console.log('‚úÖ Rating stored:', appData.currentSessionRating);
                
                // Update visual stars
                const stars = document.querySelectorAll('#session-rating-stars .star');
                console.log('üîÑ Updating', stars.length, 'stars');
                
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.add('filled');
                    } else {
                        star.classList.remove('filled');
                    }
                });
                
                console.log('‚úÖ Star display updated');
            },

            async saveSession() {
                console.log('üíæ Saving cooking session...');
                
                const rating = appData.currentSessionRating;
                const photoFile = document.getElementById('session-photo')?.files[0];
                
                console.log('üìä Session data:', {
                    rating,
                    hasPhoto: !!photoFile,
                    recipeTitle: appData.currentRecipeForLogging?.title
                });
                
                if (!rating || rating < 1 || rating > 5) {
                    alert('Please select a rating from 1 to 5 stars.');
                    console.log('‚ùå Save failed: invalid rating');
                    return;
                }
                
                if (!appData.currentRecipeForLogging) {
                    alert('No recipe selected for logging.');
                    console.log('‚ùå Save failed: no recipe selected');
                    return;
                }
                
                let photoUrl = null;
                if (photoFile) {
                    try {
                        // Convert to base64 data URL instead of blob URL
                        photoUrl = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = (e) => resolve(e.target.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(photoFile);
                        });
                        console.log('üì∑ Photo converted to base64 data URL');
                    } catch (error) {
                        console.error('‚ùå Failed to process photo:', error);
                        alert('Failed to process photo. Please try again.');
                        return;
                    }
                }
                
                const today = new Date().toISOString().split('T')[0];
                const logEntry = {
                    date: today,
                    rating: rating,
                    photo: photoUrl
                };
                
                console.log('üîÑ Adding log entry:', logEntry);
                
                appData.currentRecipeForLogging.cookingLog.unshift(logEntry);
                
                // Always update recipe's main photo with the most recent photo
                if (photoUrl) {
                    appData.currentRecipeForLogging.photo = photoUrl;
                    console.log('üì∑ Updated recipe main photo with newest image');
                }
                
                console.log('‚úÖ Session saved successfully');
                console.log('üìä Recipe now has', appData.currentRecipeForLogging.cookingLog.length, 'logged sessions');
                
                // Show success message
                const successDiv = document.getElementById('log-session-success');
                if (successDiv) {
                    successDiv.innerHTML = '<div class="success-message">üç≥ Cooking session logged successfully! Your rating and history have been updated.</div>';
                    successDiv.style.display = 'block';
                    console.log('‚úÖ Success message shown');
                } else {
                    console.error('‚ùå Success div not found');
                }
                
                // Return to recipes after 2 seconds
                setTimeout(() => {
                    console.log('üîÑ Returning to recipes section...');
                    this.showSection('my-recipes');
                    this.displayRecipes();
                    appData.currentRecipeForLogging = null;
                    appData.currentSessionRating = 0;
                    console.log('‚úÖ Returned to recipes with updated data');
                }, 2000);
            },

            cancelSession() {
                console.log('‚ùå Cancelling log session...');
                this.showSection('my-recipes');
                appData.currentRecipeForLogging = null;
                appData.currentSessionRating = 0;
                console.log('‚úÖ Session cancelled, returned to recipes');
            },

            deleteRecipe(recipeId) {
                console.log('üóëÔ∏è Deleting recipe with ID:', recipeId);
                
                try {
                    // Find the recipe to get its title for feedback
                    const recipe = appData.recipes.find(r => r.id === recipeId);
                    if (!recipe) {
                        console.error('‚ùå Recipe not found with ID:', recipeId);
                        alert('Recipe not found!');
                        return;
                    }
                    
                    const recipeTitle = recipe.title;
                    console.log('‚úÖ Recipe found for deletion:', recipeTitle);
                    
                    // Remove the recipe from the array
                    const originalCount = appData.recipes.length;
                    appData.recipes = appData.recipes.filter(r => r.id !== recipeId);
                    const newCount = appData.recipes.length;
                    
                    if (newCount === originalCount) {
                        console.error('‚ùå Recipe was not removed from array');
                        alert('Failed to delete recipe. Please try again.');
                        return;
                    }
                    
                    console.log(`‚úÖ Recipe deleted successfully. Recipes count: ${originalCount} ‚Üí ${newCount}`);
                    
                    // Refresh the display
                    this.displayRecipes();
                    console.log('üîÑ Recipe display refreshed');
                    
                    // Show success message briefly if there are still recipes
                    if (newCount > 0) {
                        const recipesList = document.getElementById('recipes-list');
                        if (recipesList) {
                            const successMsg = document.createElement('div');
                            successMsg.className = 'success-message';
                            successMsg.innerHTML = `‚úÖ "${recipeTitle}" has been deleted successfully.`;
                            successMsg.style.marginBottom = '20px';
                            
                            recipesList.insertBefore(successMsg, recipesList.firstChild);
                            
                            // Remove success message after 3 seconds
                            setTimeout(() => {
                                if (successMsg.parentNode) {
                                    successMsg.parentNode.removeChild(successMsg);
                                }
                            }, 3000);
                        }
                    }
                    
                } catch (error) {
                    console.error('‚ùå Error in deleteRecipe:', error);
                    alert('An error occurred while deleting the recipe. Please try again.');
                }
            }
        };

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üåü DOM loaded, starting Recipe Manager...');
            RecipeManager.init();
        });
    </script>
</body>
</html>